<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width, initial-scale=1.0, maximum-scale=1"><meta name=description content=""><meta name=author content="Zachary Snow"><title>Generating string permutations for unit testing</title><base href=../../ ><link href="https://fonts.googleapis.com/css?family=Open+Sans" rel=stylesheet><link rel=stylesheet type=text/css href=css/style.css><link rel=alternate type=application/rss+xml title="The Blog of Zachary Snow" href=feed.rss><div class=wrap><nav class="navbar navbar-expand-lg navbar-dark bg-dark"><h1><a class=navbar-brand href=/ >The Blog of Zachary Snow</a></h1><button id=navbar-toggler class=navbar-toggler type=button aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation"><span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=index.html>Home</a><li class=nav-item><a class=nav-link href=about.html>About</a></ul><div class="social my-2 my-lg-0"><a href=https://twitter.com/smack0007 class=twitter title=Twitter><span class=icon-twitter></span></a> <a href=https://github.com/smack0007 class=github title=Github><span class=icon-github></span></a> <a href=https://paypal.me/smack0007 class=coffee title="Buy Me a Coffee"><span class=icon-mug></span></a> <a href=feed.rss class=rss title=RSS><span class=icon-rss></span></a></div></div></nav><main class=container><div class=posts><div class=post><h2><a href=blog/2019/generating-string-permutations-for-unit-testing.html>Generating string permutations for unit testing</a></h2><div class=meta><span class=date><span class=icon-calendar></span>February 11, 2019</span> <span class=category><span class=icon-folder></span>c#</span> <span class=tags><span class=icon-price-tags></span>c#, nunit, math</span></div><div class=content><p>I needed to parse a string containing 6 characters. Each character should only be one of 3 possibilities: '?' for null, '0' for false or '1' for true. The problem sounded easy enough to generate a whole bunch of unit tests for.<p>I'm wrapping the string in a struct and simply reading the values for any given field. That class looks sort of like this:
<pre><code class=language-c#><span class=RoslynHtmlSyntaxHighlighter><span class="keyword keyword-public">public</span> <span class="keyword keyword-struct">struct</span> <span class=identifier>MyData</span>
<span class=token>{</span>
    <span class="keyword keyword-public">public</span> <span class="keyword keyword-bool">bool</span><span class=token>?</span> <span class=identifier>Field1</span> <span class=token>{</span> <span class="keyword keyword-get">get</span><span class=token>;</span> <span class=token>}</span>

    <span class="keyword keyword-public">public</span> <span class="keyword keyword-bool">bool</span><span class=token>?</span> <span class=identifier>Field2</span> <span class=token>{</span> <span class="keyword keyword-get">get</span><span class=token>;</span> <span class=token>}</span>

    <span class="keyword keyword-public">public</span> <span class="keyword keyword-bool">bool</span><span class=token>?</span> <span class=identifier>Field3</span> <span class=token>{</span> <span class="keyword keyword-get">get</span><span class=token>;</span> <span class=token>}</span>

    <span class="keyword keyword-public">public</span> <span class="keyword keyword-bool">bool</span><span class=token>?</span> <span class=identifier>Field4</span> <span class=token>{</span> <span class="keyword keyword-get">get</span><span class=token>;</span> <span class=token>}</span>

    <span class="keyword keyword-public">public</span> <span class="keyword keyword-bool">bool</span><span class=token>?</span> <span class=identifier>Field5</span> <span class=token>{</span> <span class="keyword keyword-get">get</span><span class=token>;</span> <span class=token>}</span>

    <span class="keyword keyword-public">public</span> <span class="keyword keyword-bool">bool</span><span class=token>?</span> <span class=identifier>Field6</span> <span class=token>{</span> <span class="keyword keyword-get">get</span><span class=token>;</span> <span class=token>}</span>
<span class=token>}</span>
<span class=token></span></span></code></pre><p>I wanted to generate unit tests for every possibly permuation of the string. We're using NUnit so this can be acheived using TestCaseSource:
<pre><code class=language-c#><span class=RoslynHtmlSyntaxHighlighter><span class="keyword keyword-public">public</span> <span class="identifier identifier-generic">IEnumerable</span><span class=token><</span><span class="keyword keyword-object">object</span><span class=token>[</span><span class=token></span><span class=token>]</span><span class=token>></span> <span class="identifier identifier-method">TestValues</span><span class=token>(</span><span class=token>)</span>
<span class=token>{</span>
    <span class="keyword keyword-statement keyword-return">return</span>
        <span class="keyword keyword-from">from</span> <span class=identifier>f1</span> <span class="keyword keyword-statement keyword-in">in</span> <span class="identifier identifier-invocation">FieldValues</span><span class=token>(</span><span class=token>)</span>
        <span class="keyword keyword-from">from</span> <span class=identifier>f2</span> <span class="keyword keyword-statement keyword-in">in</span> <span class="identifier identifier-invocation">FieldValues</span><span class=token>(</span><span class=token>)</span>
        <span class="keyword keyword-from">from</span> <span class=identifier>f3</span> <span class="keyword keyword-statement keyword-in">in</span> <span class="identifier identifier-invocation">FieldValues</span><span class=token>(</span><span class=token>)</span>
        <span class="keyword keyword-from">from</span> <span class=identifier>f4</span> <span class="keyword keyword-statement keyword-in">in</span> <span class="identifier identifier-invocation">FieldValues</span><span class=token>(</span><span class=token>)</span>
        <span class="keyword keyword-from">from</span> <span class=identifier>f5</span> <span class="keyword keyword-statement keyword-in">in</span> <span class="identifier identifier-invocation">FieldValues</span><span class=token>(</span><span class=token>)</span>
        <span class="keyword keyword-from">from</span> <span class=identifier>f6</span> <span class="keyword keyword-statement keyword-in">in</span> <span class="identifier identifier-invocation">FieldValues</span><span class=token>(</span><span class=token>)</span>
        <span class="keyword keyword-select">select</span> <span class="keyword keyword-new">new</span> <span class="keyword keyword-object">object</span><span class=token>[</span><span class=token></span><span class=token>]</span>
        <span class=token>{</span>
            <span class="keyword keyword-new">new</span> <span class="keyword keyword-string">string</span><span class=token>(</span><span class="keyword keyword-new">new</span> <span class="keyword keyword-char">char</span><span class=token>[</span><span class=token></span><span class=token>]</span> <span class=token>{</span> <span class="identifier identifier-member-access">f1</span><span class=token>.</span><span class="identifier identifier-member-access">Key</span><span class=token>,</span> <span class="identifier identifier-member-access">f2</span><span class=token>.</span><span class="identifier identifier-member-access">Key</span><span class=token>,</span> <span class="identifier identifier-member-access">f3</span><span class=token>.</span><span class="identifier identifier-member-access">Key</span><span class=token>,</span> <span class="identifier identifier-member-access">f4</span><span class=token>.</span><span class="identifier identifier-member-access">Key</span><span class=token>,</span> <span class="identifier identifier-member-access">f5</span><span class=token>.</span><span class="identifier identifier-member-access">Key</span><span class=token>,</span> <span class="identifier identifier-member-access">f6</span><span class=token>.</span><span class="identifier identifier-member-access">Key</span> <span class=token>}</span><span class=token>)</span><span class=token>,</span>
            <span class="identifier identifier-member-access">f1</span><span class=token>.</span><span class="identifier identifier-member-access">Value</span><span class=token>,</span>
            <span class="identifier identifier-member-access">f2</span><span class=token>.</span><span class="identifier identifier-member-access">Value</span><span class=token>,</span>
            <span class="identifier identifier-member-access">f3</span><span class=token>.</span><span class="identifier identifier-member-access">Value</span><span class=token>,</span>
            <span class="identifier identifier-member-access">f4</span><span class=token>.</span><span class="identifier identifier-member-access">Value</span><span class=token>,</span>
            <span class="identifier identifier-member-access">f5</span><span class=token>.</span><span class="identifier identifier-member-access">Value</span><span class=token>,</span>
            <span class="identifier identifier-member-access">f6</span><span class=token>.</span><span class="identifier identifier-member-access">Value</span>
        <span class=token>}</span><span class=token>;</span>
<span class=token>}</span>

<span class="keyword keyword-public">public</span> <span class="identifier identifier-generic">IEnumerable</span><span class=token><</span><span class="identifier identifier-generic">KeyValuePair</span><span class=token><</span><span class="keyword keyword-char">char</span><span class=token>,</span> <span class="keyword keyword-bool">bool</span><span class=token>?</span><span class=token>></span><span class=token>></span> <span class="identifier identifier-method">FieldValues</span><span class=token>(</span><span class=token>)</span>
<span class=token>{</span>
    <span class="keyword keyword-statement keyword-yield">yield</span> <span class="keyword keyword-statement keyword-return">return</span> <span class="keyword keyword-new">new</span> <span class="identifier identifier-generic">KeyValuePair</span><span class=token><</span><span class="keyword keyword-char">char</span><span class=token>,</span> <span class="keyword keyword-bool">bool</span><span class=token>?</span><span class=token>></span><span class=token>(</span><span class=token>'?'</span><span class=token>,</span> <span class="keyword keyword-null">null</span><span class=token>)</span><span class=token>;</span>
    <span class="keyword keyword-statement keyword-yield">yield</span> <span class="keyword keyword-statement keyword-return">return</span> <span class="keyword keyword-new">new</span> <span class="identifier identifier-generic">KeyValuePair</span><span class=token><</span><span class="keyword keyword-char">char</span><span class=token>,</span> <span class="keyword keyword-bool">bool</span><span class=token>?</span><span class=token>></span><span class=token>(</span><span class=token>'0'</span><span class=token>,</span> <span class="keyword keyword-false">false</span><span class=token>)</span><span class=token>;</span>
    <span class="keyword keyword-statement keyword-yield">yield</span> <span class="keyword keyword-statement keyword-return">return</span> <span class="keyword keyword-new">new</span> <span class="identifier identifier-generic">KeyValuePair</span><span class=token><</span><span class="keyword keyword-char">char</span><span class=token>,</span> <span class="keyword keyword-bool">bool</span><span class=token>?</span><span class=token>></span><span class=token>(</span><span class=token>'1'</span><span class=token>,</span> <span class="keyword keyword-true">true</span><span class=token>)</span><span class=token>;</span>
<span class=token>}</span>

<span class=token>[</span><span class="identifier identifier-method">TestCaseSource</span><span class=token>(</span><span class="identifier identifier-invocation">nameof</span><span class=token>(</span><span class="identifier identifier-invocation">TestValues</span><span class=token>)</span><span class=token>)</span><span class=token>]</span>
<span class="keyword keyword-public">public</span> <span class="keyword keyword-void">void</span> <span class="identifier identifier-method">ValuesAreCorrect</span><span class=token>(</span>
    <span class="keyword keyword-string">string</span> <span class="identifier identifier-method">value</span><span class=token>,</span>
    <span class="keyword keyword-bool">bool</span><span class=token>?</span> <span class="identifier identifier-method">f1</span><span class=token>,</span>
    <span class="keyword keyword-bool">bool</span><span class=token>?</span> <span class="identifier identifier-method">f2</span><span class=token>,</span>
    <span class="keyword keyword-bool">bool</span><span class=token>?</span> <span class="identifier identifier-method">f3</span><span class=token>,</span>
    <span class="keyword keyword-bool">bool</span><span class=token>?</span> <span class="identifier identifier-method">f4</span><span class=token>,</span>
    <span class="keyword keyword-bool">bool</span><span class=token>?</span> <span class="identifier identifier-method">f5</span><span class=token>,</span>
    <span class="keyword keyword-bool">bool</span><span class=token>?</span> <span class="identifier identifier-method">f6</span><span class=token>)</span>
<span class=token>{</span>
    <span class="identifier identifier-variable">var</span> <span class="identifier identifier-variable">data</span> <span class=token>=</span> <span class="keyword keyword-new">new</span> <span class="identifier identifier-variable">MyData</span><span class=token>(</span><span class="identifier identifier-variable">value</span><span class=token>)</span><span class=token>;</span>
    <span class="identifier identifier-member-access">Assert</span><span class=token>.</span><span class="identifier identifier-member-access">AreEqual</span><span class=token>(</span><span class="identifier identifier-member-access">data</span><span class=token>.</span><span class="identifier identifier-member-access">Field1</span><span class=token>,</span> <span class="identifier identifier-invocation">f1</span><span class=token>)</span><span class=token>;</span>
    <span class="identifier identifier-member-access">Assert</span><span class=token>.</span><span class="identifier identifier-member-access">AreEqual</span><span class=token>(</span><span class="identifier identifier-member-access">data</span><span class=token>.</span><span class="identifier identifier-member-access">Field2</span><span class=token>,</span> <span class="identifier identifier-invocation">f2</span><span class=token>)</span><span class=token>;</span>
    <span class="identifier identifier-member-access">Assert</span><span class=token>.</span><span class="identifier identifier-member-access">AreEqual</span><span class=token>(</span><span class="identifier identifier-member-access">data</span><span class=token>.</span><span class="identifier identifier-member-access">Field3</span><span class=token>,</span> <span class="identifier identifier-invocation">f3</span><span class=token>)</span><span class=token>;</span>
    <span class="identifier identifier-member-access">Assert</span><span class=token>.</span><span class="identifier identifier-member-access">AreEqual</span><span class=token>(</span><span class="identifier identifier-member-access">data</span><span class=token>.</span><span class="identifier identifier-member-access">Field4</span><span class=token>,</span> <span class="identifier identifier-invocation">f4</span><span class=token>)</span><span class=token>;</span>
    <span class="identifier identifier-member-access">Assert</span><span class=token>.</span><span class="identifier identifier-member-access">AreEqual</span><span class=token>(</span><span class="identifier identifier-member-access">data</span><span class=token>.</span><span class="identifier identifier-member-access">Field5</span><span class=token>,</span> <span class="identifier identifier-invocation">f5</span><span class=token>)</span><span class=token>;</span>
    <span class="identifier identifier-member-access">Assert</span><span class=token>.</span><span class="identifier identifier-member-access">AreEqual</span><span class=token>(</span><span class="identifier identifier-member-access">data</span><span class=token>.</span><span class="identifier identifier-member-access">Field6</span><span class=token>,</span> <span class="identifier identifier-invocation">f6</span><span class=token>)</span><span class=token>;</span>
<span class=token>}</span>
<span class=token></span></span></code></pre><p>This geneartes 721 unit tests which is the correct number of tests according to the formula <a href=https://www.mathsisfun.com/combinatorics/combinations-permutations.html><strong><em>n<sup>k</sup></em></strong></a>.</div></div></div><div class=clear></div></main></div><script>document.getElementById("navbar-toggler").onclick=function(){document.getElementById("navbarSupportedContent").classList.toggle("collapse")}</script>